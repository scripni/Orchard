@using Orchard.Widgets.Models;
@{
    Style.Require("WidgetsAdmin");
    Script.Require("jQuery");
    IEnumerable<LayerPart> layers = Model.Layers;
}
<script type="text/javascript">
//<![CDATA[
    document.write("<div id=\"widgets-layer-visibility\"><h5>Hide widgets in other layers:</h5></div>");
//]]>
</script>
@using(Script.Foot()) {
<script type="text/javascript">
//<![CDATA[
    (function ($) {
        var currentLayerId = @Model.CurrentLayer.Id;
        var layers = [
        @foreach (var layer in layers) {
            <text>{"name":"@layer.Name","id":@layer.Id}@(layer != layers.Last() ? "," : "")</text>
        }
        ];
        var visWrapper = $("#widgets-layer-visibility");
        var visContainer = $("<ul></ul>");
    
        var widgetPlacement = $("#widgets-zones");
        for (var i = 0; i < layers.length; i++) {
            var layersWidgets = widgetPlacement.find(".widgets-layer-" + layers[i].id);
            if (layersWidgets.length > 0) {
                var layer = $("<li class=\"widgets-" + ((layers[i].id == currentLayerId && "this") || "other") + "-layer\">" + layers[i].name + "</li>");
                layer.data("widgets", layersWidgets);
                visContainer.append(layer);
            }
        }

        $("#widgets-layer-visibility .widgets-other-layer").live("click", function() {
            var _this = $(this);
            _this.toggleClass("off");
            if (_this.hasClass("off")) {
                _this.data("widgets").hide();
            }
            else {
                _this.data("widgets").show();
            }
        });
        $("#widgets-layer-visibility .widgets-other-layer").live("hover", function() {
            $(this).data("widgets").toggleClass("on");
        });

        visWrapper.append(visContainer);
    })(jQuery);
//]]>
</script>
}
